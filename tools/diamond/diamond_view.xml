<tool id="bg_diamond_view" name="Diamond" version="@VERSION@.0">
    <description>generate formatted output from DAA files</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <expand macro="stdio" />
    <expand macro="version_command" />
    <command><![CDATA[
    diamond
        view
	@OUTPUT_ARGS@
	@HITFILTER_ARGS@
	$forwardonly
	--compress '0'
    ]]>
    </command>
    <inputs>
        <param argument="--daa" type="data" format="daa" label="input file in DAA format" />
        <expand macro="output_type_macro" />
	<expand macro="hit_filter_macro" />
        <param argument="--forwardonly" type="boolean" truevalue="--forwardonly" falsevalue="" checked="false" label="only show alignments of forward strand" help=""/>
    </inputs>
    <outputs>
        <expand macro="output_macro" />
    </outputs>
    <tests>
        <test>
            <param name="daa" ftype="daa" value="diamond_results.daa" />
            <conditional name="output">
                <param name="outfmt" value="5"/>
            </conditional>
            <conditional name="hit_filter">
                <param name="hit_filter_select" value="max"/>
                <param name="max_target_seqs" value="25" />
            </conditional>
	    <output name="blast_tabular" file="diamond_results.xml"/>
        </test>
        <test>
            <param name="daa" ftype="daa" value="diamond_results.daa" />
            <conditional name="output">
                <param name="outfmt" value="6"/>
		<param name="fields" value="qseqid,sseqid,pident,length,mismatch,gapopen,qstart,qend,sstart,send,evalue,bitscore"/>
            </conditional>
            <output name="blast_tabular" file="diamond_results.tabular"/>
        </test>
        <test>
            <param name="daa" ftype="daa" value="diamond_results.daa" />
            <conditional name="output">
                <param name="outfmt" value="101"/>
            </conditional>
            <param name="forwardonly" value="--forwardonly" />
	    <output name="blast_tabular" file="diamond_results.tabular"/>
        </test>
	<!--        <test>
            <conditional name="method_cond">
	        <param name="method_select" value="blastp" />
            </conditional>
            <param name="query" value="protein.fasta" ftype="fasta"/>
	    <conditional name="ref_db_source">
                <param name="db_source" value="history"/>
                <param name="reference_database" value="db.dmnd"/>
            </conditional>
            <conditional name="output">
                <param name="outfmt" value="100"/>
            </conditional>
            <output name="daa_output" file="diamond_results.daa"/>
	</test>-->
    </tests>

    <help>
<![CDATA[

**What it does**

Converts diamond daa files to multiple other formats. 

**Input**

Input data is a daa file. 


**Output**

Alignment results in BLAST format (pairwise/tabular), xml, sam, taxonomic (Note the latter does not work with the current diamond version. )

BLAST tables contain the following columns. 

Column 	Description
1 	    Query Seq-id (ID of your sequence)
2 	    Subject Seq-id (ID of the database hit)
3 	    Percentage of identical matches
4 	    Alignment length
5 	    Number of mismatches
6 	    Number of gap openings
7 	    Start of alignment in query
8 	    End of alignment in query
9 	    Start of alignment in subject (database hit)
10 	    End of alignment in subject (database hit)
11 	    Expectation value (E-value)
12 	    Bit score
]]>
    </help>
    <expand macro="citations" />
</tool>
