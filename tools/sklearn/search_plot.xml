<tool id="sk_search_plot" name="Plot Visualization" version="@VERSION@">
    <description>of SearchCV results</description>
    <macros>
        <import>main_macros.xml</import>
    </macros>
    <expand macro="python_requirements">
        <requirement type="package" version="3.1.1">plotly</requirement>
    </expand>
    <expand macro="macro_stdio"/>
    <version_command>echo "@VERSION@"</version_command>
    <command><![CDATA[
    python '$plot_script' '$inputs'
]]>
    </command>
    <configfiles>
        <inputs name="inputs"/>
        <configfile name="plot_script">
<![CDATA[
import sys
import json
import plotly
import plotly.graph_objs as go
import pandas as pd

input_json_path = sys.argv[1]
with open(input_json_path, "r") as param_handler:
    params = json.load(param_handler)

df = pd.read_csv("$search_results", sep='\t', parse_dates=True)

dimensions = []
for index in params['col_dimensions']:
    values = df[df.columns[index-1]]
    dimensions.append(
        dict(   range = [min(values), max(values)],
                label = df.columns[index-1],
                values = values
        )
    )
col_score = params['col_score'][0] - 1
scores = df[df.columns[col_score]]
line = dict(
            color = scores,
            colorscale = 'Jet',
            showscale = True,
            reversescale = True,
            cmin = min(scores),
            cmax = max(scores)
)
data = [
    go.Parcoords(
        line = line,
        dimensions = dimensions
    )
]

plotly.offline.plot(data, filename = "output.html", auto_open=False)


]]>
        </configfile>
    </configfiles>
    <inputs>
        <param name="search_results" type="data" format="tabular" label="Select a result from SearchCV:"/>
        <param name="col_dimensions" multiple="true" type="data_column" data_ref="search_results" use_header_names="true" display="checkboxes" label="Select the columns for dimentions:"/>
        <param name="col_score" type="data_column" data_ref="search_results" use_header_names="true" label="Select a column containg the score for coloring:"/>
    </inputs>

    <outputs>
        <data name="output" format="html" from_work_dir="output.html" label="Plot of SearchCV result on ${on_string}"/>
    </outputs>
    <tests>
        <test>
            <param name="search_results" value="cv_result01.tabular" ftype="tabular"/>
            <param name="col_dimensions" value="4,5"/>
            <param name="col_score" value="3"/>
            <output name="output" file="searchcv_plot01.html" compare="sim_size"/>
        </test>

    </tests>
    <help><![CDATA[
**What it does**

    ]]>
    </help>
    <expand macro="sklearn_citation"/>
</tool>
