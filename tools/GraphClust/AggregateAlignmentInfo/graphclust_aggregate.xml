<tool id="graphclust_aggregate" name="Aggregate and filter alignment metrics of individual clusters, like the output of graphclust_align_cluster" version="0.1.0">
    <requirements>
        <requirement type="package" version="0.6.0">graphclust-wrappers</requirement>
        <requirement type="package" version="0.23.0">pandas</requirement>
    </requirements>
    <command detect_errors="exit_code">
    <![CDATA[
        mkdir ./clusters_metrics &&
        #for $tsv in $alignment_cons_tsv:
                ###set $inputFiles += str($tsv.element_identifier)+','
            ln -f -s  '$tsv' ./clusters_metrics/${tsv.element_identifier}.tsv &&
        #end for
        ls &&
        ls ./clusters_metrics &&
        aggregate_align_metrics.py 
        --RNAz-prob-threshold 0.5  
        --rscape-bp-threshold 2 
        --min-seq-num 3 
        ## --exclude-spu
        --clusters-tsv-pattern 
        "clusters_metrics/*.tsv" 
        --filtered-tsv-out filtered-alignment-metrics.tsv
        --bed-out bed-cluster-locations.bed
            
    ]]></command>
    <inputs>
        <param type="data" name="alignment_cons_tsv" format="tabular" multiple="True"/>
    </inputs>
    <outputs>
        <data name="filtered_tsv" format="tabular" from_work_dir="filtered-alignment-metrics.tsv" label="filtered-alignment-metrics.tsv"  />
        <data name="bed_clusters" format="tabular" from_work_dir="bed-cluster-locations.bed" label="bed-cluster-locations.bed"  />
    </outputs>
    <tests>
        <test>
            <param name="alignment_cons_tsv" value="1.alignment.cons.tsv,2.alignment.cons.tsv,3.alignment.cons.tsv"/>            
            <output name="filtered_tsv" file="metrics1.tsv"  />
            <output name="bed_clusters" file="clusters1.bed"  />
        </test>
    </tests>
    <help><![CDATA[
Aggregate and filter alignment metrics of individual clusters, like the output
of graphclust_align_cluste
    ]]></help>

  <citations>
    <citation type="doi">10.5281/zenodo.597695</citation>
  </citations>

</tool>