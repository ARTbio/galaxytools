<tool id="openduck_run_smd" name="Run OpenDUck" version="@VERSION@">
    <description>steered molecular dynamics runs</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <command detect_errors="exit_code"><![CDATA[
        duck_smd_runs
            -i $input
            -p $pickle
            -n $num
            -l $mdlen
            -d $start_dist
            -v $vel
            #if $OPENDUCK_GPU_PARAM:
                --gpu-id $OPENDUCK_GPU_PARAM
            #end if &&
        tar -czf allfiles.tar.gz --exclude=allfiles.tar.gz * &&
        get_wqb -l $ligand -o $ligand_wqb
    ]]></command>
    <inputs>
        <param argument="input" type="data" format='binary' label="Chunk file from DUck equilibration"/>
        <param argument="pickle" type="data" format='binary' label="Pickle file from DUck equilibration"/>
        <param argument="ligand" type="data" format='sdf,mol' label="SDF/MOL file containing a single ligand"/>
        <param argument="num" type="integer" min="0" value="1" label="Number of SMD runs" help="Number of steered molecular dynamics runs to perform."/>
        <param argument="mdlen" type="float" min="0" value="0.05" label="MD run length (ns)" help="Length of initial MD run (prior to steered molecular dynamics runs)."/>
        <param argument="start_dist" type="float" min="0" value="2.5" label="Starting distance" help="Initial length of the selected interaction between protein and ligand."/>
        <param argument="vel" type="float" min="0" value="0.00001" label="Velocity" help="Distance (in angstroms) to perturb the system per simulation step in the SMD runs. Decreasing this value will increase simulation time."/>
    </inputs>
    <outputs>
        <data name="ligand_wqb" format="sdf"/>
        <data name="tar" hidden="true" format="tar" from_work_dir="allfiles.tar.gz"/>
    </outputs>
    <tests>
        <test>
            <param name="input" value="equil.chk" />
            <param name="pickle" value="complex_system.pickle" />
            <param name="ligand" value="ligand.mol" />
            <param name="num" value="1" />
            <param name="mdlen" value="0.05" />
            <param name="start_dist" value="2.5" />
            <param name="vel" value="0.00001" />
            <output name="ligand_wqb" file="ligand_wqb.mol" lines_diff="2" />
        </test>
    </tests>
    <help><![CDATA[

.. class:: infomark

**What it does**

Perform steered molecular dynamics runs for dynamic undocking (DUck) on a prepared protein-ligand system.

This Galaxy tool uses OpenDUck, an open-source implementation of the original DUck method, using OpenMM and AmberTools.

_____

.. class:: infomark

**Input**

       - Ligand in SDF/MOL format.  
       - Python pickle file containing the prepared complex as an OpenMM object
       - Chunk file for the equilibrated protein.

_____


.. class:: infomark

**Output**

       - Ligand in SDF/MOL format, with added `SCORE.DUCK_WQB` parameter.

A tar file is also produced as a hidden output, containing all files produced by the tool.

    ]]></help>

    <expand macro="citations" />
</tool>