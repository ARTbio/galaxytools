<tool id="openduck_chunk" name="OpenDUck chunk" version="@VERSION@">
    <description>for dynamic undocking</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <command detect_errors="exit_code"><![CDATA[
        cp $ligand ./ligand.sdf &&
        duck_chunk
            -p $protein
            -l ./ligand.sdf
            -c $cutoff
            $ignore_buffers
            ## -i is interaction, e.g. A_ASP_156_OD2
            -i ${chain_sel}_${res_sel}_${resid_sel}_${atom_sel} &&
        tar -czf allfiles.tar.gz --exclude=allfiles.tar.gz *
    ]]></command>
    <inputs>
        <param argument="protein" type="data" format='pdb' label="PDB file for apoprotein"/>
        <param argument="ligand" type="data" format='sdf,mol' label="SDF/MOL file containing a single ligand"/>
        <param argument="cutoff" type="float" min="0" value="5" label="Cutoff" help="Cutoff for chunk generation (in angstroms)" />
        <param argument="ignore_buffers" type="select" label="Ignore buffers (solvent, ions etc.)?">
            <option value="">Remove buffers</option>
            <option value="-b">Leave buffers</option>
        </param>

        <expand macro="interaction_params" />

    </inputs>
    <outputs>
        <data name="chunk" format="pdb" from_work_dir="protein_out_prot.pdb"/>
        <data name="tar" hidden="true" format="tar" from_work_dir="allfiles.tar.gz"/>
    </outputs>
    <tests>
        <test>
            <param name="protein" value="1n2v_apo.pdb" />
            <param name="ligand" value="ligand.mol" />
            <param name="cutoff" value="5" />
            <param name="ignore_buffers" value="" />
            <param name="chain_sel" value="A" />
            <param name="res_sel" value="ASP" />
            <param name="resid_sel" value="156" />
            <param name="atom_sel" value="OD2" />
            <output name="chunk" file="protein_out_prot.pdb" />
        </test>
    </tests>
    <help><![CDATA[

.. class:: infomark

**What it does**

Produce chunk automatically for dynamic undocking (DUck). Chunking entails selecting a region of the protein which is used for a DUck simulation.

This Galaxy tool uses OpenDUck, an open-source implementation of the original DUck method, using OpenMM and AmberTools.

_____

.. class:: infomark

**Input**

       - PDB file for protein
       - SDF/MOL file for ligand
     
_____

        
.. class:: infomark

**Output**

       - PDB file containing the chunked protein ready for system preparation.

A tar file is also produced as a hidden output, containing all files produced by the tool.

    ]]></help>
    <expand macro="citations" />
</tool>