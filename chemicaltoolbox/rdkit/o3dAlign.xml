<tool id="ctb_rdkit_o3dAlign" name="Open 3D Align" version="@VERSION@.0">
    <description>with RDKit</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <command detect_errors="exit_code"><![CDATA[
        ln -s $molquery ./molquery.${molquery.ext} &&
        python3 '$__tool_directory__/o3dAlign.py'
            -i '$infile'
            -if 'sdf'
            --query './molquery.${molquery.ext}'
            --qmolidx '$qmolidx'
            $crippen
            -n '$number'
            -t '$threshold'
            -a '$attempts'
            -r '$rmsd'
            -e '$emin'
            -of 'sdf'
            -o '$outfile'
            -l '$logfile'
    ]]></command>
    <inputs>
        <param name="infile" type="data" format="sdf" label="Input file" help="Input file in SDF format"/>
        <param name="molquery" type="data" format="mol" label="Mol query file" help="Mol file to align against"/>
        <param name="qmolidx" type="integer" value="1" label="Query molecule index" help="Query molecule index in SD-file if not the first"/>
        <param name="threshold" type="float" value="1" label="Threshold" help="Score cutoff relative to alignment of query to itself"/>
        <param name="number" type="integer" value="0" label="Number of conformers" help="Number of conformers to generate, if 0 then input structures are assumed to already be 3D')"/>
        <param name="rmsd" type="float" value="1.0" label="RMSD Threshold" help="Prune RMSD threshold for excluding conformers"/>
        <param name="attempts" type="integer" value="0" label="Number of attempts" help="If confomers fall below the RMSD threshold, number of attempts at regeneration before giving up."/>
        <param name="emin" type="integer" value="0" label="Energy minimisation iterations" help="Number of EM iterations using the MMFF force field. Default is 0 (i.e. no EM)."/>
        <param name="crippen" type="boolean" label="Crippen" truevalue="-t" falsevalue="" help="Use Crippen (logP) contributions"/>
    </inputs>    
    <outputs>
        <data name="logfile" format="txt" label="Logfile for ${tool.name}"/>
        <data name="outfile" format="sdf">
            <change_format>
                <when input="output_opts" value="json" format="json" />
            </change_format>
        </data>
    </outputs>
    <tests>
        <test>
            <param name="infile" value="Kinase_inhibs.sdf" ftype="sdf"/>
            <param name="molquery" value="pyrimethamine.mol" ftype="mol"/>
            <param name="threshold" value="10" />
            <param name="number" value="2" />
            <param name="output_opts" value="sdf" />
            <output name="logfile">
                <assert_contents>
                    <has_text text="Perfect score: 0.000 114.134 CCc1nc(N)nc(N)c1-c1ccc(Cl)cc1 17"/>
                </assert_contents>
            </output>
        </test>
        <test>
            <param name="infile" value="Kinase_inhibs.sdf" ftype="sdf"/>
            <param name="molquery" value="pyrimethamine.mol" ftype="mol"/>
            <param name="threshold" value="10" />
            <param name="number" value="2" />
            <param name="output_opts" value="json" />
            <output name="logfile">
                <assert_contents>
                    <has_text text="Perfect score: 0.000 114.134 CCc1nc(N)nc(N)c1-c1ccc(Cl)cc1 17"/>
                </assert_contents>
            </output>
        </test>
        <test>
            <param name="infile" value="Kinase_inhibs.sdf" ftype="sdf"/>
            <param name="molquery" value="pyrimethamine.mol" ftype="mol"/>
            <param name="threshold" value="10" />
            <param name="number" value="2" />
            <param name="crippen" value="-t" />
            <param name="output_opts" value="sdf" />
            <output name="logfile">
                <assert_contents>
                    <has_text text="Perfect score: 0.000 114.134 CCc1nc(N)nc(N)c1-c1ccc(Cl)cc1 17"/>
                </assert_contents>
            </output>
        </test> 
    </tests>
    <help><![CDATA[

.. class:: infomark

**What this tool does**

Aligns molecules using RDKit's Open 3D Align.

.. class:: infomark

**Input**

| - Input file in `SDF Format`_

.. _SDF Format: http://en.wikipedia.org/wiki/Chemical_table_file
.. _SMILES: http://en.wikipedia.org/wiki/Simplified_molecular_input_line_entry_specification

-----

.. class:: infomark

 **Output**

SD-file of aligned compounds.

]]></help>
    <expand macro="citations" />
</tool>