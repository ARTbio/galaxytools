<tool id="ctb_rdkit_screen" name="Screen" version="@VERSION@.0">
    <description>ABCD</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <command detect_errors="exit_code"><![CDATA[
        python3 '$__tool_directory__/screen.py'
        --smiles_mol '$comparator.input'
        -i '$infile'
        -if '${infile.ext}'
        #if $comparator.comparator_opts == 'mol'
            --isMol
        #end if
        #if $fragment_opts != 'none'
            -f '$fragment_opts'
        #end if
        --simmin '$sim_min'
        --simmax '$sim_max'
        -d '$descriptor_opts'
        -m '$metric_opts'
        #if $hac_min != ''
            --hacmin '$hac_min'
        #end if
        #if $hac_max != ''
            --hacmax '$hac_max'
        #end if
        #if $mw_min != ''
            --mwmin '$mw_min'
        #end if
        #if $mw_max != ''
            --mwmax '$mw_max'
        #end if
        $thin
        $quiet
        -o '$outfile'
        -of '${outfile.ext}'
    ]]></command>
    <inputs>
        <conditional name="comparator">
            <param name='comparator_opts' type='select' format='text' label="Input type" help="Enter SMILES string or Mol file.">
                <option value='smiles'>SMILES</option>
                <option value='mol'>Mol</option>
            </param>
            <when value='smiles'>
                <param name="input" type="text" label="SMILES input" help="Enter SMILES for a compound.">
                    <validator type='length' min='5'/>
                </param>
            </when>
            <when value='mol'>
                <param name="input" type="data" format="mol" label="Mol input" help="Input file in mol format"/>
            </when>
        </conditional>          
        <param name="infile" type="data" format="sdf,json" label="Input file" help="Input file in SDF or JSON format, for comparison"/>
        <param name="sim_min" type="float" label="Similarity lower cutoff" value="0.7" help="(1.0 means identical)"/>
        <param name="sim_max" type="float" label="Similarity upper cutoff" value="1.0" help="(1.0 means identical)"/>
        <param name="descriptor_opts" type="select" label="Type of descriptor or fingerprint" help="Default is rdkit">
            <option value="rdkit" selected="true">rdkit</option>
            <option value="maccs">maccs</option>
            <option value="morgan2">morgan2</option>
            <option value="morgan3">morgan3</option>
        </param>
        <param name="metric_opts" type="select" label="Similarity metric" help="Default is tanimoto">
            <option value="tanimoto" selected="true">tanimoto</option>
            <option value="asymmetric">asymmetric</option>
            <option value="braunblanquet">braunblanquet</option>
            <option value="cosine">cosine</option>
            <option value="dice">dice</option>
            <option value="kulczynski">kulczynski</option>
            <option value="mcconnaughey">mcconnaughey</option>
            <option value="rogotgoldberg">rogotgoldberg</option>
            <option value="russel">russel</option>
            <option value="sokal">sokal</option>
        </param>
        <param name="fragment_opts" type="select" loptional="true" label="Fragment" help="Find single fragment if more than one (hac = biggest by heavy atom count, mw = biggest by mol weight )">
            <option value="none" selected="true">None</option>
            <option value="hac">hac</option>
            <option value="mw">mw</option>
        </param>
        <param name="hac_min" type="integer" optional="true" label="Minimum heavy atom count" help="ABC"/>
        <param name="hac_max" type="integer" optional="true" label="Maximum heavy atom count" help="ABC"/>
        <param name="mw_min" type="float" optional="true" label="Minimum mol weight" help="ABC"/>
        <param name="mw_max" type="float" optional="true" label="Minimum mol weight" help="ABC"/>
        <param name="thin" type="boolean" label="Thin Mode" truevalue="-t" falsevalue="" help="ABC"/>
        <param name="quiet" type="boolean" label="Quiet Mode" truevalue="-q" falsevalue="" help="ABC"/>
    </inputs>
    <outputs>
        <data format_source="infile" name="outfile" metadata_source="infile" />
    </outputs>
    <tests>
        <test>
            <param name='comparator_opts' value="smiles"/>
            <param name="input" value="C1N=C(C2=CC=CC=C2)C2=CC=CC=C2C2=C1C=NC(NC1=CC=CC=C1)=N2"/>
            <param name="infile" value="dhfr_3d.sdf" ftype="sdf"/>
            <param name="descriptor_opts" value="rdkit" />
            <param name="metric_opts" value="tanimoto" />
            <param name="fragment_opts" value="none" />
            <param name="sim_min" value="0.45" />
            <param name="sim_max" value="1.0" />
            <output name="outfile" ftype='sdf' file="screen_output1.sdf"/>
        </test>
        <test>
            <param name='comparator_opts' value="mol"/>
            <param name="input" value="pyrimethamine.mol"/>
            <param name="infile" value="dhfr_3d.sdf" ftype="sdf"/>
            <param name="descriptor_opts" value="rdkit" />
            <param name="metric_opts" value="tanimoto" />
            <param name="fragment_opts" value="none" />
            <param name="sim_min" value="0.7" />
            <param name="sim_max" value="0.8" />
            <output name="outfile" ftype='sdf' file="screen_output2.sdf"/>
        </test>
        <test>
            <param name='comparator_opts' value="smiles"/>
            <param name="input" value="C1N=C(C2=CC=CC=C2)C2=CC=CC=C2C2=C1C=NC(NC1=CC=CC=C1)=N2"/>
            <param name="infile" value="nci100.data" ftype="json"/>
            <param name="descriptor_opts" value="rdkit" />
            <param name="metric_opts" value="tanimoto" />
            <param name="fragment_opts" value="none" />
            <param name="sim_min" value="0.45" />
            <param name="sim_max" value="1.0" />
            <output name="outfile" ftype='json' file="screen_output3.json"/>
        </test>
    </tests>
    <help><![CDATA[
        ABCCDEFGHIJKLMNOPQRSTUVWXYZ
    ]]></help>
    <expand macro="citations" />
</tool>