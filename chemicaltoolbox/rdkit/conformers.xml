<tool id="ctb_rdkit_conformers" name="Generate conformers" version="@VERSION@.0">
    <description>using RDKit</description>
    <macros>
        <token name="@VERSION@">2019.03.1</token>
        <requirement type="package" version="2.4.8">im-pipelines-utils</requirement>
        <requirement type="package" version="1.5.10">im-pipelines-utils-rdkit</requirement>
    </macros>
    <requirements>
        <requirement type="package" version="@VERSION@">rdkit</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        python3 '$__tool_directory__/conformers.py'
        -s '$smiles_input'
        -n '$num'
        -a '$attempts'
        -r '$rmsd'
        -c '$conditional_cluster.cluster_method_opts'
        #if $conditional_cluster.cluster_method_opts != 'none':
            -t '$conditional_cluster.threshold'
        #end if
        -e '$emin'
        -f '$conf_output'
    ]]></command>
    <inputs>
        <param name="smiles_input" type="text" label="SMILES Format" help="ABC"/>
        <param name="num" type="integer" label="Number of conformers to generate" value="1"/>
        <param name="attempts" type="integer" label="Number of attempts" value="1" help="Conformers which are below the RMSD threshold are regenerated. This parameter controls how many times this regeneration should be attempted before giving up. "/>
        <param name="rmsd" type="float" label="RMSD threshold" value="1.0" help="If a conformer is too similar to those already generated (below the RMSD threshold), it is discarded and regenerated."/>
        <conditional name="conditional_cluster">
            <param name="cluster_method_opts" type="select" label="Cluster" help="RST">
                <option value="none" selected="true">None</option>
                <option value="rmsd">RSDM</option>
                <option value="tfd">TFD</option>
            </param>
            <when value="none">
            </when>
            <when value="rmsd">
                <param name="threshold" type="float" label="Cluster threshold" value="2.0" help="Default of 2.0 for RMSD"/>
            </when>
            <when value="tfd">
                <param name="threshold" type="float" label="Cluster threshold" value="0.3" help="Default of 0.3 for TFD"/>
            </when>
        </conditional>
        <param name="emin" type="integer" label="Energy minimisation iterations" value="0" help="Number of EM iterations using the MMFF force field. Default is 0 (i.e. no EM)."/>
    </inputs>
    <outputs>
        <data name="conf_output" format="sdf" />
    </outputs>
    <tests>
        <test>
            <param name="smiles_input" value="C(C1C(C(C(C(O1)O)O)O)O)O"/>
            <param name="num" value="1"/>
            <param name="attempts" value="0"/>
            <param name="rmsd" value="1.0"/>
            <param name="cluster_method_opts" value="rmsd"/>
            <param name="emin" value="0"/>
            <output name="conf_output" ftype='sdf' file="conf_output_rmsd.sdf"/>
        </test>
        <test>
            <param name="smiles_input" value="C(C1C(C(C(C(O1)O)O)O)O)O"/>
            <param name="num" value="1"/>
            <param name="attempts" value="0"/>
            <param name="rmsd" value="1.0"/>
            <param name="cluster_method_opts" value="rmsd"/>
            <param name="emin" value="0"/>
            <output name="conf_output" ftype='sdf' file="conf_output_tfd.sdf"/>
        </test>
    </tests>
    <help><![CDATA[
        ABCCDEFGHIJKLMNOPQRSTUVWXYZ
    ]]></help>
    <citations>
        <citation type="bibtex">
@misc{githubconformers.py,
  author = {LastTODO, FirstTODO},
  year = {TODO},
  title = {conformers.py},
  publisher = {GitHub},
  journal = {GitHub repository},
  url = {https://github.com/InformaticsMatters/pipelines/blob/master/src/python/pipelines/rdkit/conformers.py},
}</citation>
    </citations>
</tool>
