<tool id="ctb_rdkit_conformers" name="Generate conformers" version="@VERSION@.0">
    <description>using RDKit</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <command detect_errors="exit_code"><![CDATA[
        python3 '$__tool_directory__/conformers.py'
        -i '$infile'
        -if '${infile.ext}'
        #if $smiles
            --smiles '$smiles'
        #end if
        -n '$num'
        -a '$attempts'
        -r '$rmsd'
        #if $conditional_cluster.cluster_method_opts != 'none'
            -c '$conditional_cluster.cluster_method_opts'
            -t '$conditional_cluster.threshold'
        #end if
        -e '$emin'
        -o '$outfile'
        -of '${outfile.ext}'
        -l '$logfile'
    ]]></command>
    <inputs>
        <param name="infile" type="data" format="sdf" label="Input file" help="Input file in SDF format"/>
        <param name="smiles" type="text" optional="true" label="SMILES input" help="Enter SMILES for a compound.">
                    <validator type='length' min='5'/>
        </param>
        <param name="num" type="integer" label="Number of conformers to generate" value="1"/>
        <param name="rmsd" type="float" value="1.0" label="RMSD threshold" help="If a conformer is too similar to those already generated (below the RMSD threshold), it is discarded and regenerated."/>
        <param name="attempts" type="integer" value="0" label="Number of attempts" help="Conformers which are below the RMSD threshold are regenerated. This parameter controls how many times this regeneration should be attempted before giving up. "/>
        <conditional name="conditional_cluster">
            <param name="cluster_method_opts" type="select" label="Cluster method" help="RMSD, TFD (torsion fingerprint deviation) or no clustering.">
                <option value="none" selected="true">None</option>
                <option value="rmsd">RMSD</option>
                <option value="tfd">TFD</option>
            </param>
            <when value="rmsd">
                <param name="threshold" type="float" label="Cluster threshold" value="2.0" help="Default of 2.0 for RMSD"/>
            </when>
            <when value="tfd">
                <param name="threshold" type="float" label="Cluster threshold" value="0.3" help="Default of 0.3 for TFD"/>
            </when>
            <when value="none">
            </when>
        </conditional>
        <param name="emin" type="integer" value="0" label="Energy minimisation iterations" help="Number of EM iterations using the MMFF force field. Default is 0 (i.e. no EM)."/>
    </inputs>
    <outputs>
        <data name="outfile" format="sdf" />
        <data name="logfile" format="txt" label="Logfile for ${tool.name}"/>
    </outputs>
    <tests>
        <test>
            <param name="infile" ftype='sdf' value="Kinase_inhibs.sdf"/>
            <param name="num" value="2"/>
            <output name="logfile">
                <assert_contents>
                    <has_text text="Generated conformers for 36 molecules"/>
                </assert_contents>
            </output>
        </test>
        <test>
            <param name="infile" ftype='sdf' value="Kinase_inhibs.sdf"/>
            <param name="num" value="2"/>
            <param name="cluster_method_opts" value="rmsd"/>
            <output name="logfile">
                <assert_contents>
                    <has_text text="Generated conformers for 36 molecules"/>
                </assert_contents>
            </output>
        </test>
    </tests>
    <help><![CDATA[
        ABCCDEFGHIJKLMNOPQRSTUVWXYZ
    ]]></help>
    <expand macro="citations" />
</tool>
