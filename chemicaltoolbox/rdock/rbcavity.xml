<tool id="rbcavity" name="rDock cavity definition" version="0.1">
    <description>Tool to generate the active site definition needed for rDock docking</description>
    <requirements>
        <requirement type="package" version="2013.1-0">rdock</requirement>
    </requirements>
    <command><![CDATA[
echo "RBT_PARAMETER_FILE_V1.00" > receptor.prm &&
echo "RECEPTOR_FILE receptor.mol2" >> receptor.prm &&
echo "RECEPTOR_FLEX 3.0" >> receptor.prm &&
echo "SECTION MAPPER" >> receptor.prm &&
echo "    SITE_MAPPER RbtLigandSiteMapper" >> receptor.prm &&
echo "    REF_MOL ligand.sdf" >> receptor.prm &&
echo "    RADIUS $radius" >> receptor.prm &&
echo "    SMALL_SPHERE $sphere" >> receptor.prm &&
echo "    MIN_VOLUME $min_volume" >> receptor.prm &&
echo "    MAX_CAVITIES 1" >> receptor.prm &&
echo "    VOL_INCR $vol_incr" >> receptor.prm &&
echo "    GRIDSTEP $gridstep" >> receptor.prm &&
echo "END_SECTION" >> receptor.prm &&
echo "SECTION CAVITY" >> receptor.prm &&
echo "    SCORING_FUNCTION RbtCavityGridSF" >> receptor.prm &&
echo "    WEIGHT $weight" >> receptor.prm &&
echo "END_SECTION" >> receptor.prm &&
ln -s '$receptor' receptor.mol2 &&
ln -s '$ligand' ligand.sdf &&
rbcavity -was -d -r receptor.prm &&
mv receptor.as '$activesite'
    ]]></command>
    <inputs>
        <param type="data" name="receptor" format="mol2" label="Receptor" help="Select a receptor (Mol2 format)."/>
        <param type="data" name="ligand" format="sdf" multiple="true" label="Reference ligand" help="Single ligand in SDF format"/>
        <param name="radius" type="float" value="6.0" label="Mapper sphere radius" help="Mapper radius of large sphere"/>
        <param name="sphere" type="float" value="1.0" label="Mapper small sphere radius" help="Mapper radius of small sphere"/>
        <param name="min_volume" type="integer" value="100" label="Mapper min volume" help="Mapper minimum volume"/>
        <param name="vol_incr" type="float" value="0.0" label="Mapper volume increment" help="Mapper volume increment"/>
        <param name="gridstep" type="float" value="0.5" label="Mapper grid step" help="Mapper grid step"/>
        <param name="weight" type="float" value="1.0" label="Cavity weight" help="Cavity weight"/>
    </inputs>
    <outputs>
        <data name="activesite" format="binary" label="rbcavity active site on ${on_string}"/>
    </outputs>
    <tests>
        <test>
            <param name="receptor" value="receptor.mol2"/>
            <param name="ligand" value="ligand.sdf"/>
            <output name="activesite" file="receptor.as" compare="sim_size"/>
        </test>
    </tests>
    <help><![CDATA[

.. class:: infomark

This tool generates the cavity definition for rDock docking (the receptor.as file) using the rbcavity program.
See http://rdock.sourceforge.net/ for more details about rDock and associated programs.
Only a subset of the parameters are currently exposed. Read the rDock docs for a full understanding.

-----

.. class:: infomark

**Inputs**

1. The protein receptor to dock into as a file in Mol2 format.
2. A reference ligand used to define the location of the active site in SDF format.
3. Various parameters for the mapper and cavity generation. Sensible defaults are provided for all.

-----

.. class:: infomark

**Outputs**

An active site definition file (receptor.as) that is needed by the rDock docking program to guide the docking.
This is in binary format.

    ]]></help>
    <citations>
        <citation type="doi">10.1371/journal.pcbi.1003571</citation>
    </citations>
</tool>
