<tool id="ctb_rdkit_cluster_butina" name="Butina Cluster" version="@VERSION@.0">
    <description>ABCD</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <command detect_errors="exit_code"><![CDATA[
        cluster_butina
            -i '$infile'
            -if sdf
            -t '$threshold'
            -d '$descriptor_opts'
            -m '$metric_opts'
            #if $number != ''
                -n '$number'
            #end if
            -e '$exclude'
            #if $fragment_opts
                --fragment-method '$fragment_opts'
            #end if
            #if $field_conditional.use_field == 't'
                #if $field_conditional.field
                    -f '$field_conditional.field'
                    $field_conditional.field_opts
                #end if
            #end if
            $output_fragment
            -o outp
            -of sdf &>> $logfile &&
            gzip -d outp.sdf.gz
    ]]></command>
    <inputs>
        <param name="infile" type="data" format="sdf" label="Input file" help="Input file in SDF format"/>
        <param name="threshold" type="float" value="0.7" label="Threshold" help="Similarity clustering threshold (1.0 means identical)"/>
        <param name="descriptor_opts" type="select" label="Descriptor Options" help="Descriptor or fingerprint type (default rdkit)">
            <option value="rdkit" selected="true">rdkit</option>
            <option value="maccs">maccs</option>
            <option value="morgan2">morgan2</option>
            <option value="morgan3">morgan3</option>
        </param>
        <param name="metric_opts" type="select" label="Similarity metric" help="Default is the Tanimoto coefficient">
            <option value="tanimoto" selected="true">tanimoto</option>
            <option value="asymmetric">asymmetric</option>
            <option value="braunblanquet">braunblanquet</option>
            <option value="cosine">cosine</option>
            <option value="dice">dice</option>
            <option value="kulczynski">kulczynski</option>
            <option value="mcconnaughey">mcconnaughey</option>
            <option value="rogotgoldberg">rogotgoldberg</option>
            <option value="russel">russel</option>
            <option value="sokal">sokal</option>
        </param>
        <param name="number" type="integer" optional="true" label="Number for diverse subset selection" help="Maximum number to pick for diverse subset selection. Leave blank for no maximum."/>
        <param name="exclude" type="float" value="0.9" label="Exclude Threshold" help="Threshold for excluding structures in diverse subset selection (1.0 means identical)"/>
        <param name="fragment_opts" type="select" optional="true" label="Find single fragment" help="Find single fragment if more than one (hac = biggest by heavy atom count, mw = biggest by mol weight )">
            <option value="hac" selected="true">Biggest by heavy atom count</option>
            <option value="mw">Biggest by molecular weight</option>
        </param>
        <param name="output_fragment" type="boolean" label="Output Fragment" truevalue="--output-fragment" falsevalue="" help="Output the biggest fragment rather than the original molecule"/>
        <conditional name="field_conditional">
            <param name="use_field" type="boolean" label="Use Field" truevalue="t" falsevalue="f" help="XYZ"/>
            <when value="t">
                <param name="field" type="text" label="Field" help="Field to use to optimise diverse subset selection"/>
                <param name="field_opts" type="select" label="Field Options" help="pick lowest or highest value specified by the 'field' component">
                    <option value="--min" selected="true">min</option>
                    <option value="--max">max</option>
                </param>
            </when>
            <when value="f" />
        </conditional>
    </inputs>    
    <outputs>
        <data name="outfile" format="sdf" label="SDF output for ${tool.name}" from_work_dir="outp.sdf"/>
        <data name="logfile" format="txt" label="Logfile for ${tool.name}"/>
    </outputs>
    <tests>
        <test>
            <param name="infile" value="Kinase_inhibs.sdf" ftype="sdf"/>
            <param name="descriptor_opts" value="rdkit"/>
            <param name="metric_opts" value="tanimoto"/>
            <param name="threshold" value="0.6"/>
            <param name="fragment_opts" value="hac"/>
            <output name="outfile" ftype='sdf' file="cluster_butina_output1.sdf"/>
            <output name="logfile">
                <assert_contents>
                    <has_text text="Found 30 clusters"/>
                </assert_contents>
            </output>
        </test>
    </tests>
    <help><![CDATA[
        ABCCDEFGHIJKLMNOPQRSTUVWXYZ
    ]]></help>
    <expand macro="citations"/>
</tool>